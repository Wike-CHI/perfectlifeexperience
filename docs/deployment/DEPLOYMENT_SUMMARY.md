# å……å¡å®¢æˆ·ä½™é¢æ”¯ä»˜ä¸å»¶è¿Ÿç»“ç®— - å®Œæ•´äº¤ä»˜æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ¬¡å¼€å‘å®ç°äº†å……å¡å®¢æˆ·çš„ä½™é¢æ”¯ä»˜åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰è®¢å•ç»Ÿä¸€å»¶è¿Ÿç»“ç®—æ¨å¹¿å¥–åŠ±çš„æœºåˆ¶ï¼Œå®Œå…¨é¿å…äº†é€€è´§æ—¶éœ€è¦è¿½å›å·²å‘æ”¾å¥–åŠ±çš„é£é™©ã€‚

---

## âœ… å·²å®Œæˆçš„å¼€å‘å·¥ä½œ

### 1. äº‘å‡½æ•°å¼€å‘

#### 1.1 Order äº‘å‡½æ•°ï¼ˆå·²å®Œæˆï¼‰
**æ–‡ä»¶ï¼š** `cloudfunctions/order/index.js`

**æ–°å¢åŠŸèƒ½ï¼š**
- âœ… `payWithBalance` actionï¼šä½™é¢æ”¯ä»˜è®¢å•
  - è®¢å•çŠ¶æ€éªŒè¯
  - é’±åŒ…ä½™é¢å……è¶³æ€§æ£€æŸ¥
  - ä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
  - æ‰£é™¤ä½™é¢å¹¶è®°å½•äº¤æ˜“
  - æ›´æ–°è®¢å•çŠ¶æ€

- âœ… `settleOrderReward` å‡½æ•°ï¼šç»“ç®—è®¢å•æ¨å¹¿å¥–åŠ±
  - è°ƒç”¨ promotion äº‘å‡½æ•°
  - æ ‡è®°è®¢å•å¥–åŠ±å·²ç»“ç®—
  - é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

- âœ… `checkIsRepurchase` å‡½æ•°ï¼šæ£€æŸ¥å¤è´­çŠ¶æ€

- âœ… `updateOrderStatus` å‡½æ•°å¢å¼ºï¼š
  - è®¢å•å®Œæˆæ—¶è‡ªåŠ¨è§¦å‘å¥–åŠ±ç»“ç®—
  - æ”¯æŒæ‰€æœ‰æ”¯ä»˜æ–¹å¼ï¼ˆç»Ÿä¸€å»¶è¿Ÿç»“ç®—ï¼‰

**å…³é”®æ—¥å¿—ï¼š**
- `[ä½™é¢æ”¯ä»˜] å¼€å§‹ è®¢å•:XXX`
- `[ä½™é¢æ”¯ä»˜] å½“å‰ä½™é¢:XXXåˆ† éœ€æ”¯ä»˜:XXXåˆ†`
- `[ä½™é¢æ”¯ä»˜] ä½™é¢ä¸è¶³`
- `[ä½™é¢æ”¯ä»˜] æ‰£é™¤ä½™é¢:XXXåˆ† å‰©ä½™:XXXåˆ†`
- `[ä½™é¢æ”¯ä»˜] äº¤æ˜“è®°å½•å·²åˆ›å»º`
- `[ä½™é¢æ”¯ä»˜] äº‹åŠ¡æäº¤æˆåŠŸ`
- `[è®¢å•å®Œæˆ] è§¦å‘æ¨å¹¿å¥–åŠ±ç»“ç®—`
- `[å¥–åŠ±ç»“ç®—] æˆåŠŸ/å¤±è´¥`

#### 1.2 Test-Helper äº‘å‡½æ•°ï¼ˆæ–°å»ºï¼‰
**æ–‡ä»¶ï¼š** `cloudfunctions/test-helper/index.js`

**æä¾›çš„æµ‹è¯•åŠŸèƒ½ï¼š**
- âœ… `checkOrder`ï¼šæ£€æŸ¥è®¢å•çŠ¶æ€å’Œå­—æ®µ
- âœ… `checkWallet`ï¼šæ£€æŸ¥é’±åŒ…ä½™é¢å’Œäº¤æ˜“è®°å½•
- âœ… `simulateOrderComplete`ï¼šæ¨¡æ‹Ÿè®¢å•å®Œæˆè§¦å‘ç»“ç®—
- âœ… `checkRewardRecords`ï¼šæŸ¥è¯¢å¥–åŠ±è®°å½•
- âœ… `getTestData`ï¼šè·å–æµ‹è¯•æ•°æ®
- âœ… `testBalancePayment`ï¼šæµ‹è¯•ä½™é¢æ”¯ä»˜æµç¨‹
- âœ… `verifyMigration`ï¼šéªŒè¯æ•°æ®åº“è¿ç§»

### 2. å‰ç«¯å¼€å‘

#### 2.1 è®¢å•ç¡®è®¤é¡µï¼ˆå·²å®Œæˆï¼‰
**æ–‡ä»¶ï¼š** `src/pages/order/confirm.vue`

**æ–°å¢åŠŸèƒ½ï¼š**
- âœ… é’±åŒ…ä½™é¢åŠ è½½å’Œæ˜¾ç¤º
- âœ… `isBalanceSufficient` è®¡ç®—å±æ€§
- âœ… ä½™é¢æ”¯ä»˜é€‰é¡¹ä¼˜åŒ–ï¼š
  - æ˜¾ç¤ºå¯ç”¨ä½™é¢
  - ä½™é¢ä¸è¶³æ—¶ç¦ç”¨å¹¶æç¤º
  - æ˜¾ç¤ºå·®é¢é‡‘é¢
- âœ… æ”¯ä»˜æ–¹å¼åˆ†æµï¼š
  - `selectBalancePayment()`ï¼šé€‰æ‹©ä½™é¢æ”¯ä»˜
  - `payWithBalanceProcess()`ï¼šä½™é¢æ”¯ä»˜æµç¨‹
  - `payWithWechatProcess()`ï¼šå¾®ä¿¡æ”¯ä»˜æµç¨‹

**UIæ”¹è¿›ï¼š**
- å‹å¥½çš„ä½™é¢æç¤º
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- åŠ è½½çŠ¶æ€æ˜¾ç¤º

#### 2.2 è®¢å•è¯¦æƒ…é¡µï¼ˆå·²å®Œæˆï¼‰
**æ–‡ä»¶ï¼š** `src/pages/order/detail.vue`

**æ”¹è¿›ï¼š**
- âœ… æ·»åŠ æ³¨é‡Šè¯´æ˜ç»Ÿä¸€å»¶è¿Ÿç»“ç®—ç­–ç•¥
- âœ… ç§»é™¤æ”¯ä»˜æˆåŠŸæ—¶çš„ç«‹å³ç»“ç®—é€»è¾‘

### 3. æ•°æ®åº“è®¾è®¡

#### 3.1 æ–°å¢å­—æ®µï¼ˆorders é›†åˆï¼‰
```javascript
{
  rewardSettled: Boolean,      // æ¨å¹¿å¥–åŠ±æ˜¯å¦å·²ç»“ç®—
  rewardSettleTime: Date       // æ¨å¹¿å¥–åŠ±ç»“ç®—æ—¶é—´
}
```

#### 3.2 äº‹åŠ¡ä¿è¯
- ä½™é¢æ‰£é™¤
- äº¤æ˜“è®°å½•æ·»åŠ 
- è®¢å•çŠ¶æ€æ›´æ–°

ä¸‰æ­¥æ“ä½œä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ï¼Œç¡®ä¿åŸå­æ€§ï¼Œä»»ä¸€æ­¥éª¤å¤±è´¥åˆ™å…¨éƒ¨å›æ»šã€‚

---

## ğŸ“š æ–‡æ¡£ä¸æŒ‡å—

### 1. éƒ¨ç½²æŒ‡å—
**æ–‡ä»¶ï¼š** `DEPLOYMENT_GUIDE.md`

**åŒ…å«å†…å®¹ï¼š**
- äº‘å‡½æ•°éƒ¨ç½²æ­¥éª¤ï¼ˆå¾®ä¿¡å¼€å‘è€…å·¥å…· + è…¾è®¯äº‘æ§åˆ¶å°ï¼‰
- æ•°æ®åº“è¿ç§»è¯¦ç»†æ­¥éª¤
- åŠŸèƒ½æµ‹è¯•åœºæ™¯ï¼ˆ5ä¸ªå®Œæ•´åœºæ™¯ï¼‰
- ç›‘æ§ä¸æ—¥å¿—éªŒè¯
- å›æ»šæ–¹æ¡ˆ
- å®Œæ•´æ£€æŸ¥æ¸…å•

### 2. æ•°æ®åº“è¿ç§»æŒ‡å—
**æ–‡ä»¶ï¼š** `DATABASE_MIGRATION_GUIDE.md`

**åŒ…å«å†…å®¹ï¼š**
- æ•°æ®å¤‡ä»½æ­¥éª¤
- å­—æ®µæ·»åŠ æ–¹æ³•ï¼ˆæ§åˆ¶å° + äº‘å‡½æ•°ï¼‰
- æ‰¹é‡æ›´æ–°ç°æœ‰æ•°æ®è„šæœ¬
- éªŒè¯æŸ¥è¯¢
- ç´¢å¼•ä¼˜åŒ–å»ºè®®
- æ³¨æ„äº‹é¡¹å’Œé£é™©æç¤º

### 3. å¿«é€Ÿæµ‹è¯•æŒ‡å—
**æ–‡ä»¶ï¼š** `QUICK_TEST_GUIDE.md`

**åŒ…å«å†…å®¹ï¼š**
- æ§åˆ¶å°å¿«é€ŸéªŒè¯å‘½ä»¤
- test-helper äº‘å‡½æ•°ä½¿ç”¨ç¤ºä¾‹
- å‰ç«¯åŠŸèƒ½æµ‹è¯•æ­¥éª¤
- å¸¸è§é—®é¢˜æ’æŸ¥
- å¯å¤åˆ¶çš„æŸ¥è¯¢å‘½ä»¤

### 4. å®æ–½è®¡åˆ’
**æ–‡ä»¶ï¼š** `.claude/plans/witty-forging-lemon.md`

**åŒ…å«å†…å®¹ï¼š**
- å®Œæ•´çš„æŠ€æœ¯å®æ–½æ–¹æ¡ˆ
- æ‰€æœ‰ä¿®æ”¹çš„ä»£ç ç¤ºä¾‹
- éªŒè¯æ­¥éª¤å’Œæµ‹è¯•ç”¨ä¾‹

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### Step 1: éƒ¨ç½²äº‘å‡½æ•°

**é€šè¿‡å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼ˆæ¨èï¼‰ï¼š**

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. æ‰“å¼€é¡¹ç›®ï¼š`/Users/johnny/Desktop/å°ç¨‹åº/perfectlifeexperience`
3. ç‚¹å‡»å·¦ä¾§"äº‘å¼€å‘"
4. æ‰¾åˆ° `order` äº‘å‡½æ•°
5. å³é”® â†’ "ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"
6. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆ30-60ç§’ï¼‰
7. éƒ¨ç½² `test-helper` äº‘å‡½æ•°ï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯•ï¼‰

**éªŒè¯éƒ¨ç½²ï¼š**
- äº‘å‡½æ•°çŠ¶æ€æ˜¾ç¤º"æ­£å¸¸"
- ç‚¹å‡»"æµ‹è¯•"æŒ‰é’®ï¼Œè¾“å…¥ï¼š
  ```json
  {
    "action": "createOrder",
    "data": {}
  }
  ```
- åº”è¿”å›æ­£å¸¸å“åº”

### Step 2: æ•°æ®åº“è¿ç§»

**æ–¹æ³• Aï¼šé€šè¿‡æ§åˆ¶å°ç•Œé¢ï¼ˆæ¨èï¼Œè®¢å•æ•°å°‘ï¼‰**

1. æ‰“å¼€äº‘å¼€å‘æ§åˆ¶å°ï¼šhttps://tcb.cloud.tencent.com/dev?envId=cloud1-6gmp2qy3171c353#/db
2. é€‰æ‹© `orders` é›†åˆ
3. ç‚¹å‡»ä»»æ„è®°å½•è¿›å…¥è¯¦æƒ…
4. ç‚¹å‡»"æ·»åŠ å­—æ®µ"
5. æ·»åŠ å­—æ®µ1ï¼š
   - åç§°ï¼š`rewardSettled`
   - ç±»å‹ï¼šBoolean
   - é»˜è®¤å€¼ï¼šfalse
6. æ·»åŠ å­—æ®µ2ï¼š
   - åç§°ï¼š`rewardSettleTime`
   - ç±»å‹ï¼šDate
   - é»˜è®¤å€¼ï¼šç•™ç©º

**æ–¹æ³• Bï¼šé€šè¿‡ test-helper äº‘å‡½æ•°ï¼ˆæ¨èï¼Œè®¢å•æ•°å¤šï¼‰**

1. éƒ¨ç½² `test-helper` äº‘å‡½æ•°
2. åœ¨äº‘å‡½æ•°æ§åˆ¶å°æµ‹è¯•ï¼š
   ```json
   {
     "action": "verifyMigration"
   }
   ```
3. æŸ¥çœ‹è¿”å›ç»“æœï¼Œç¡®è®¤å­—æ®µå·²æ·»åŠ 

**éªŒè¯è¿ç§»ï¼š**
åœ¨æ§åˆ¶å°è¿è¡ŒæŸ¥è¯¢ï¼š
```javascript
db.collection('orders').field({
  _id: true,
  rewardSettled: true
}).limit(1).get()
```

é¢„æœŸï¼šè¿”å›çš„è®°å½•åŒ…å« `rewardSettled` å­—æ®µ

### Step 3: å‰ç«¯ä»£ç æ›´æ–°

å‰ç«¯ä»£ç å·²æ›´æ–°å®Œæˆï¼Œæ— éœ€é¢å¤–éƒ¨ç½²ï¼š
- âœ… `src/pages/order/confirm.vue`
- âœ… `src/pages/order/detail.vue`

**éªŒè¯ï¼š**
åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç¼–è¯‘å¹¶é¢„è§ˆï¼Œæ£€æŸ¥ï¼š
1. è®¢å•ç¡®è®¤é¡µæ˜¾ç¤ºä½™é¢
2. ä½™é¢ä¸è¶³æ—¶æ­£ç¡®æç¤º
3. æ”¯ä»˜æµç¨‹æ­£å¸¸

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### æµ‹è¯•åœºæ™¯ 1ï¼šä½™é¢æ”¯ä»˜ - ä½™é¢å……è¶³

**æ­¥éª¤ï¼š**
1. ç™»å½•å°ç¨‹åº
2. æŸ¥çœ‹é’±åŒ…ä½™é¢ï¼ˆç¡®ä¿ > è®¢å•é‡‘é¢ï¼‰
3. é€‰æ‹©å•†å“ï¼ŒåŠ å…¥è´­ç‰©è½¦
4. è¿›å…¥ç»“ç®—é¡µé¢
5. **æ£€æŸ¥ç‚¹ 1**ï¼šæ˜¾ç¤º"å¯ç”¨ä½™é¢: Â¥XXX.XX"
6. é€‰æ‹©"ä½™é¢æ”¯ä»˜"
7. ç‚¹å‡»"æäº¤è®¢å•"
8. **æ£€æŸ¥ç‚¹ 2**ï¼šæ”¯ä»˜æˆåŠŸ

**æ•°æ®åº“éªŒè¯ï¼š**
```javascript
// è®¢å•è®°å½•
db.collection('orders').where({
  orderNo: "è®¢å•å·"
}).get()
// é¢„æœŸï¼špaymentMethod: 'balance', rewardSettled: false

// é’±åŒ…ä½™é¢
db.collection('user_wallets').where({
  _openid: "openid"
}).get()
// é¢„æœŸï¼šä½™é¢å·²å‡å°‘

// äº¤æ˜“è®°å½•
db.collection('wallet_transactions').where({
  _openid: "openid"
}).orderBy('createTime', 'desc').limit(1).get()
// é¢„æœŸï¼šæœ‰æ”¯ä»˜è®°å½•ï¼Œamountä¸ºè´Ÿæ•°
```

### æµ‹è¯•åœºæ™¯ 2ï¼šä½™é¢æ”¯ä»˜ - ä½™é¢ä¸è¶³

**æ­¥éª¤ï¼š**
1. ç¡®ä¿é’±åŒ…ä½™é¢ < 50å…ƒ
2. é€‰æ‹© 100å…ƒå•†å“
3. è¿›å…¥ç»“ç®—é¡µé¢
4. **æ£€æŸ¥ç‚¹ 1**ï¼šä½™é¢æ”¯ä»˜é€‰é¡¹æ˜¾ç¤ºç°è‰²ï¼ˆç¦ç”¨ï¼‰
5. **æ£€æŸ¥ç‚¹ 2**ï¼šç‚¹å‡»æ—¶æç¤º"ä½™é¢ä¸è¶³ï¼Œè¿˜å·® Â¥XX.XX"

### æµ‹è¯•åœºæ™¯ 3ï¼šè®¢å•å®Œæˆè§¦å‘ç»“ç®—ï¼ˆæ ¸å¿ƒï¼‰

**æ­¥éª¤ï¼š**
1. å®Œæˆä¸€ä¸ªè®¢å•çš„æ”¯ä»˜
2. è®°å½•è®¢å•ID
3. åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
db.collection('orders').doc("è®¢å•ID").update({
  data: {
    status: 'completed',
    completeTime: new Date()
  }
})
```

**éªŒè¯ç»“æœï¼š**
1. æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—ï¼ˆorder äº‘å‡½æ•°ï¼‰ï¼š
   - `[è®¢å•å®Œæˆ] è§¦å‘æ¨å¹¿å¥–åŠ±ç»“ç®—`
   - `[å¥–åŠ±ç»“ç®—] æˆåŠŸ`

2. éªŒè¯è®¢å•è®°å½•ï¼š
```javascript
db.collection('orders').doc("è®¢å•ID").get()
// é¢„æœŸï¼šrewardSettled: true, rewardSettleTime: Date
```

3. éªŒè¯å¥–åŠ±è®°å½•ï¼š
```javascript
db.collection('reward_records').where({
  orderId: "è®¢å•ID"
}).get()
// é¢„æœŸï¼šå¤šæ¡å¥–åŠ±è®°å½•
```

4. éªŒè¯æ¨å¹¿å‘˜æ”¶ç›Šï¼š
```javascript
db.collection('users').where({
  _openid: "æ¨å¹¿å‘˜openid"
}).get()
// é¢„æœŸï¼špendingReward å¢åŠ 
```

---

## ğŸ“Š éªŒè¯æ¸…å•

### éƒ¨ç½²éªŒè¯
- [ ] order äº‘å‡½æ•°å·²æ›´æ–°å¹¶éƒ¨ç½²
- [ ] äº‘å‡½æ•°çŠ¶æ€ä¸º"æ­£å¸¸"
- [ ] test-helper äº‘å‡½æ•°å·²éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰
- [ ] äº‘å‡½æ•°æµ‹è¯•é€šè¿‡

### æ•°æ®åº“éªŒè¯
- [ ] orders é›†åˆæ·»åŠ  rewardSettled å­—æ®µ
- [ ] orders é›†åˆæ·»åŠ  rewardSettleTime å­—æ®µ
- [ ] ç°æœ‰è®¢å•æ•°æ®éªŒè¯æ­£å¸¸
- [ ] ç´¢å¼•å·²åˆ›å»ºï¼ˆå¯é€‰ï¼‰

### åŠŸèƒ½éªŒè¯
- [ ] ä½™é¢å……è¶³å¯ä»¥æ­£å¸¸æ”¯ä»˜
- [ ] ä½™é¢ä¸è¶³æ—¶æ­£ç¡®æç¤ºå¹¶ç¦ç”¨
- [ ] ä½™é¢æ”¯ä»˜æ­£ç¡®æ‰£æ¬¾
- [ ] äº¤æ˜“è®°å½•æ­£ç¡®ç”Ÿæˆ
- [ ] è®¢å•å®Œæˆæ—¶è§¦å‘å¥–åŠ±ç»“ç®—
- [ ] rewardSettled å­—æ®µæ­£ç¡®æ›´æ–°
- [ ] æ¨å¹¿å¥–åŠ±è®°å½•ç”Ÿæˆ
- [ ] æ¨å¹¿å‘˜ pendingReward å¢åŠ 

### æ—¥å¿—éªŒè¯
- [ ] å…³é”®æ“ä½œæœ‰æ—¥å¿—è®°å½•
- [ ] æ²¡æœ‰å¼‚å¸¸é”™è¯¯ä¿¡æ¯
- [ ] äº‹åŠ¡æäº¤æˆåŠŸ

---

## ğŸ”— é‡è¦é“¾æ¥

### äº‘å¼€å‘æ§åˆ¶å°
- ç¯å¢ƒIDï¼š`cloud1-6gmp2qy3171c353`
- æ¦‚è§ˆï¼šhttps://tcb.cloud.tencent.com/dev?envId=cloud1-6gmp2qy3171c353#/overview
- æ•°æ®åº“ï¼šhttps://tcb.cloud.tencent.com/dev?envId=cloud1-6gmp2qy3171c353#/db
- äº‘å‡½æ•°ï¼šhttps://tcb.cloud.tencent.com/dev?envId=cloud1-6gmp2qy3171c353#/scf

### å¾®ä¿¡å°ç¨‹åº
- AppIDï¼š`wx4a0b93c3660d1404`
- é¡¹ç›®åç§°ï¼šå¤§å‹å…ƒæ°”ç²¾é…¿å•¤é…’åœ¨çº¿ç‚¹å•å°ç¨‹åº

---

## ğŸ“ å…³é”®æ–‡ä»¶åˆ—è¡¨

### äº‘å‡½æ•°
1. `cloudfunctions/order/index.js` - âœ… å·²ä¿®æ”¹
2. `cloudfunctions/test-helper/index.js` - âœ… æ–°å»º
3. `cloudfunctions/test-helper/package.json` - âœ… æ–°å»º

### å‰ç«¯
1. `src/pages/order/confirm.vue` - âœ… å·²ä¿®æ”¹
2. `src/pages/order/detail.vue` - âœ… å·²ä¿®æ”¹

### æ–‡æ¡£
1. `DEPLOYMENT_GUIDE.md` - âœ… å·²åˆ›å»º
2. `DATABASE_MIGRATION_GUIDE.md` - âœ… å·²åˆ›å»º
3. `QUICK_TEST_GUIDE.md` - âœ… å·²åˆ›å»º
4. `.claude/plans/witty-forging-lemon.md` - âœ… å·²åˆ›å»º

---

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### ä½™é¢æ”¯ä»˜æµç¨‹
```
ç”¨æˆ·é€‰æ‹©ä½™é¢æ”¯ä»˜
  â†“
å‰ç«¯éªŒè¯ä½™é¢å……è¶³
  â†“
è°ƒç”¨ payWithBalance äº‘å‡½æ•°
  â†“
äº‘å‡½æ•°ä½¿ç”¨äº‹åŠ¡ï¼š
  1. éªŒè¯è®¢å•çŠ¶æ€
  2. æ£€æŸ¥é’±åŒ…ä½™é¢
  3. æ‰£é™¤ä½™é¢
  4. è®°å½•äº¤æ˜“
  5. æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆrewardSettled: falseï¼‰
  â†“
äº‹åŠ¡æäº¤
  â†“
è¿”å›æ”¯ä»˜æˆåŠŸ
```

### ç»Ÿä¸€å»¶è¿Ÿç»“ç®—æµç¨‹
```
è®¢å•çŠ¶æ€å˜æ›´ä¸º completed
  â†“
order äº‘å‡½æ•°æ£€æµ‹åˆ°çŠ¶æ€å˜æ›´
  â†“
æ£€æŸ¥ rewardSettled å­—æ®µ
  â†“
å¦‚æœæœªç»“ç®—ï¼Œè°ƒç”¨ promotion äº‘å‡½æ•°
  â†“
è®¡ç®—å››é‡åˆ†æ¶¦å¥–åŠ±
  â†“
ç”Ÿæˆå¥–åŠ±è®°å½•ï¼ˆreward_recordsï¼‰
  â†“
æ›´æ–°æ¨å¹¿å‘˜ pendingReward
  â†“
æ›´æ–°è®¢å• rewardSettled: true
```

---

## ğŸ‰ äº¤ä»˜æˆæœ

1. **å®Œæ•´çš„ä½™é¢æ”¯ä»˜ç³»ç»Ÿ**
   - å‰ç«¯ä½™é¢æ£€æŸ¥å’Œæç¤º
   - äº‘å‡½æ•°äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
   - äº¤æ˜“è®°å½•å®Œæ•´è¿½è¸ª

2. **ç»Ÿä¸€çš„å»¶è¿Ÿç»“ç®—æœºåˆ¶**
   - æ‰€æœ‰è®¢å•åœ¨å®Œæˆæ—¶ç»“ç®—
   - é¿å…é€€è´§è¿½å›å¥–åŠ±é£é™©
   - rewardSettled å­—æ®µè¿½è¸ªçŠ¶æ€

3. **å®Œå–„çš„æµ‹è¯•å·¥å…·**
   - test-helper äº‘å‡½æ•°
   - è¯¦ç»†çš„æµ‹è¯•æŒ‡å—
   - å¿«é€ŸéªŒè¯å‘½ä»¤

4. **å®Œæ•´çš„æ–‡æ¡£**
   - éƒ¨ç½²æŒ‡å—
   - è¿ç§»æŒ‡å—
   - æµ‹è¯•æŒ‡å—
   - å®æ–½è®¡åˆ’

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. äº‘å‡½æ•°æ—¥å¿—ï¼ˆå…³é”®æ“ä½œéƒ½æœ‰è¯¦ç»†æ—¥å¿—ï¼‰
2. ä¸Šè¿°æ–‡æ¡£çš„æ’æŸ¥ç« èŠ‚
3. QUICK_TEST_GUIDE.md ä¸­çš„å¸¸è§é—®é¢˜

---

**å¼€å‘å®Œæˆæ—¥æœŸ**: 2026-02-13
**ç‰ˆæœ¬**: v2.0.0
**å¼€å‘è€…**: Claude Code

---

<promise>BALANCE_PAYMENT_AND_DELAYED_SETTLEMENT_COMPLETE</promise>
