# å°ç¨‹åºç«¯ç®¡ç†åå°ç™»å½•æŒ‡å—

**æ›´æ–°æ—¥æœŸ**: 2026-02-24

---

## ğŸ“± å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šå¾®ä¿¡å¼€å‘è€…å·¥å…·æµ‹è¯•ï¼ˆæ¨èï¼‰

#### ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘å°ç¨‹åº

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /Users/johnny/Desktop/å°ç¨‹åº/perfectlifeexperience

# ç¼–è¯‘å¾®ä¿¡å°ç¨‹åº
npm run dev:mp-weixin
```

#### ç¬¬äºŒæ­¥ï¼šæ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·

```bash
# macOS
/Applications/wechatwebdevtools.app/Contents/MacOS/cli open --project "/Users/johnny/Desktop/å°ç¨‹åº/perfectlifeexperience"
```

#### ç¬¬ä¸‰æ­¥ï¼šè¿›å…¥ç®¡ç†åå°ç™»å½•é¡µ

1. åœ¨æ¨¡æ‹Ÿå™¨ä¸­ï¼Œç‚¹å‡»å³ä¸Šè§’ **"æ¸…ç¼“å­˜"** â†’ **"å…¨éƒ¨æ¸…é™¤"**
2. åœ¨è°ƒè¯•å™¨çš„ **"AppData"** æ ‡ç­¾ä¸­ï¼Œæ‰‹åŠ¨æ·»åŠ è·¯å¾„è·³è½¬ï¼š
   ```
   /pagesAdmin/login/index
   ```
3. æˆ–è€…åœ¨ä»£ç ä¸­æ·»åŠ ä¸´æ—¶è·³è½¬ï¼ˆåœ¨ `src/pages/index/index.vue` çš„ onLoad ä¸­ï¼‰ï¼š
   ```javascript
   uni.navigateTo({
     url: '/pagesAdmin/login/index'
   })
   ```

#### ç¬¬å››æ­¥ï¼šä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•

```
ç”¨æˆ·å: admin
å¯†ç : admin123
```

#### ç¬¬äº”æ­¥ï¼šç™»å½•æˆåŠŸ

ç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°é¦–é¡µã€‚

---

### æ–¹å¼äºŒï¼šçœŸæœºè°ƒè¯•ï¼ˆéœ€è¦çœŸæœºé¢„è§ˆï¼‰

#### ç¬¬ä¸€æ­¥ï¼šç¡®ä¿å·²åˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„äº‘å‡½æ•°æ§åˆ¶å°ä¸­ï¼š

1. ç‚¹å‡» **"äº‘å¼€å‘"** æŒ‰é’®
2. è¿›å…¥ **"äº‘å‡½æ•°"** åˆ—è¡¨
3. æ‰¾åˆ° `initAdminData` äº‘å‡½æ•°
4. ç‚¹å‡» **"äº‘ç«¯æµ‹è¯•"**
5. ç‚¹å‡» **"è°ƒç”¨"** æŒ‰é’®

è¿”å›ç»“æœåº”è¯¥æ˜¾ç¤ºï¼š
```json
{
  "code": 0,
  "message": "Admin collections initialized successfully",
  "data": {
    "adminId": "xxx",
    "defaultUsername": "admin",
    "defaultPassword": "admin123"
  }
}
```

å¦‚æœæ˜¾ç¤º "Admin collections already initialized"ï¼Œè¯´æ˜å·²ç»åˆå§‹åŒ–è¿‡äº†ã€‚

#### ç¬¬äºŒæ­¥ï¼šé¢„è§ˆå°ç¨‹åº

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼Œç‚¹å‡» **"é¢„è§ˆ"** æŒ‰é’®
2. ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç 
3. åœ¨æ‰‹æœºä¸Šæ‰“å¼€å°ç¨‹åº

#### ç¬¬ä¸‰æ­¥ï¼šè¿›å…¥ç®¡ç†åå°

åœ¨å°ç¨‹åºçš„ä»»æ„é¡µé¢ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›å…¥ç®¡ç†åå°ï¼š

**æ–¹æ³•1ï¼šæ·»åŠ ç®¡ç†å…¥å£**ï¼ˆæ¨èï¼‰

åœ¨ `src/pages/user/user.vue` ä¸­æ·»åŠ ç®¡ç†åå°å…¥å£ï¼š

```vue
<template>
  <view class="user-page">
    <!-- å…¶ä»–å†…å®¹ -->

    <!-- ç®¡ç†åå°å…¥å£ -->
    <view class="admin-entry" @click="goToAdmin">
      <text class="admin-icon">âš™ï¸</text>
      <text class="admin-text">ç®¡ç†åå°</text>
    </view>
  </view>
</template>

<script setup lang="ts">
const goToAdmin = () => {
  uni.navigateTo({
    url: '/pagesAdmin/login/index'
  })
}
</script>

<style scoped>
.admin-entry {
  display: flex;
  align-items: center;
  padding: 30rpx;
  background: #fff;
  margin-top: 20rpx;
}

.admin-icon {
  font-size: 40rpx;
  margin-right: 20rpx;
}

.admin-text {
  font-size: 28rpx;
  color: #333;
}
</style>
```

**æ–¹æ³•2ï¼šç›´æ¥è¾“å…¥è·¯å¾„**

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„è°ƒè¯•å™¨æ§åˆ¶å°ä¸­ï¼š
```javascript
wx.navigateTo({
  url: '/pagesAdmin/login/index'
})
```

#### ç¬¬å››æ­¥ï¼šç™»å½•

ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•ï¼š
```
ç”¨æˆ·å: admin
å¯†ç : admin123
```

---

## ğŸ” é»˜è®¤ç®¡ç†å‘˜è´¦å·

| å­—æ®µ | å€¼ | è¯´æ˜ |
|------|---|------|
| ç”¨æˆ·å | `admin` | é»˜è®¤è¶…çº§ç®¡ç†å‘˜ |
| å¯†ç  | `admin123` | âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼ |
| è§’è‰² | `super_admin` | æ‹¥æœ‰æ‰€æœ‰æƒé™ |
| çŠ¶æ€ | `active` | è´¦å·æ¿€æ´» |

### âš ï¸ å®‰å…¨è­¦å‘Š

**é»˜è®¤å¯†ç ä»…ç”¨äºæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼**

ä¿®æ”¹å¯†ç æ–¹å¼ï¼š
```javascript
// åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„äº‘å‡½æ•°æ§åˆ¶å°
// é€‰æ‹© admin-api äº‘å‡½æ•°
// äº‘ç«¯æµ‹è¯•ï¼Œå‚æ•°å¦‚ä¸‹ï¼š
{
  "action": "changePassword",
  "data": {
    "oldPassword": "admin123",
    "newPassword": "your_new_secure_password"
  }
}
```

---

## ğŸ“‹ ç™»å½•æµç¨‹è¯´æ˜

### æŠ€æœ¯å®ç°

1. **ç”¨æˆ·è¾“å…¥**: ç”¨æˆ·åå’Œå¯†ç 
2. **APIè°ƒç”¨**: è°ƒç”¨ `admin-api` äº‘å‡½æ•°çš„ `adminLogin` æ¥å£
3. **éªŒè¯**: äº‘å‡½æ•°éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
4. **è¿”å›ä¿¡æ¯**: è¿”å›ç®¡ç†å‘˜ä¿¡æ¯å’ŒJWT token
5. **æœ¬åœ°å­˜å‚¨**: å­˜å‚¨ç®¡ç†å‘˜ä¿¡æ¯å’Œtoken
6. **è·³è½¬**: è·³è½¬åˆ°ç®¡ç†åå°é¦–é¡µ

### è®¤è¯æµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant MiniApp as å°ç¨‹åº
    participant CloudFunc as admin-apiäº‘å‡½æ•°
    participant DB as æ•°æ®åº“

    User->>MiniApp: è¾“å…¥ç”¨æˆ·åå¯†ç 
    MiniApp->>CloudFunc: adminLogin API
    CloudFunc->>DB: æŸ¥è¯¢ç®¡ç†å‘˜ä¿¡æ¯
    DB-->>CloudFunc: è¿”å›ç®¡ç†å‘˜æ•°æ®
    CloudFunc->>CloudFunc: éªŒè¯å¯†ç 
    CloudFunc->>CloudFunc: ç”ŸæˆJWT Token
    CloudFunc-->>MiniApp: è¿”å›Tokenå’Œç®¡ç†å‘˜ä¿¡æ¯
    MiniApp->>MiniApp: å­˜å‚¨åˆ°æœ¬åœ°Storage
    MiniApp->>MiniApp: è·³è½¬åˆ°ç®¡ç†åå°
```

---

## ğŸ¯ ç™»å½•åçš„æ“ä½œ

### ç®¡ç†åå°åŠŸèƒ½åˆ—è¡¨

ç™»å½•æˆåŠŸåï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹åŠŸèƒ½ï¼š

| é¡µé¢ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| ä»ªè¡¨ç›˜ | `/pagesAdmin/dashboard/index` | æ•°æ®æ¦‚è§ˆã€ç»Ÿè®¡ |
| è®¢å•ç®¡ç† | `/pagesAdmin/orders/list` | æŸ¥çœ‹ã€å¤„ç†è®¢å• |
| å•†å“ç®¡ç† | `/pagesAdmin/products/list` | å•†å“å¢åˆ æ”¹æŸ¥ |
| ç”¨æˆ·ç®¡ç† | `/pagesAdmin/users/list` | ç”¨æˆ·ä¿¡æ¯æŸ¥çœ‹ |
| è´¢åŠ¡ç®¡ç† | `/pagesAdmin/finance/index` | æç°å®¡æ‰¹ |
| æ•°æ®ç»Ÿè®¡ | `/pagesAdmin/statistics/index` | é”€å”®æ•°æ®ç»Ÿè®¡ |
| æ¨å¹¿ç®¡ç† | `/pagesAdmin/promotion/index` | æ¨å¹¿å‘˜ç®¡ç† |
| å…¬å‘Šç®¡ç† | `/pagesAdmin/announcements/list` | å…¬å‘Šå‘å¸ƒ |

### æƒé™è¯´æ˜

**super_adminï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰**:
- âœ… æ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´è®¿é—®æƒé™
- âœ… ç”¨æˆ·ç®¡ç†æƒé™
- âœ… ç³»ç»Ÿé…ç½®æƒé™

**operatorï¼ˆæ“ä½œå‘˜ï¼‰**:
- âœ… è®¢å•ç®¡ç†
- âœ… å•†å“ç®¡ç†
- âŒ ç”¨æˆ·ç®¡ç†
- âŒ ç³»ç»Ÿé…ç½®

**viewerï¼ˆæŸ¥çœ‹è€…ï¼‰**:
- âœ… æ•°æ®æŸ¥çœ‹
- âŒ ä»»ä½•ä¿®æ”¹æ“ä½œ

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ç™»å½•æç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

**å¯èƒ½åŸå› **:
1. ç®¡ç†å‘˜è´¦å·æœªåˆå§‹åŒ–
2. ç”¨æˆ·åæˆ–å¯†ç è¾“å…¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// 1. ç¡®è®¤ç®¡ç†å‘˜è´¦å·å·²åˆå§‹åŒ–
// åœ¨äº‘å‡½æ•°æ§åˆ¶å°è°ƒç”¨ initAdminData

// 2. æ£€æŸ¥æ•°æ®åº“
// åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ admins é›†åˆ
// æŸ¥çœ‹æ˜¯å¦æœ‰è®°å½•
```

### Q2: ç™»å½•åè·³è½¬é”™è¯¯

**å¯èƒ½åŸå› **:
é¡µé¢è·¯å¾„é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
æ£€æŸ¥ `src/pages.json` ä¸­ `pagesAdmin` åˆ†åŒ…é…ç½®ï¼š
```json
{
  "root": "pagesAdmin",
  "pages": [
    {
      "path": "dashboard/index",
      "style": {
        "navigationBarTitleText": "ç®¡ç†åå°"
      }
    }
  ]
}
```

### Q3: å¦‚ä½•ä¿®æ”¹é»˜è®¤å¯†ç 

**æ­¥éª¤**:

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼Œè¿›å…¥ **"äº‘å¼€å‘"** æ§åˆ¶å°
2. è¿›å…¥ **"æ•°æ®åº“"** â†’ `admins` é›†åˆ
3. æ‰¾åˆ°ç”¨æˆ·åä¸º `admin` çš„è®°å½•
4. ç‚¹å‡» **"æ›´æ–°æ–‡æ¡£"**
5. ä¿®æ”¹ `password` å­—æ®µä¸ºæ–°å¯†ç çš„**bcryptå“ˆå¸Œå€¼**

**ç”Ÿæˆbcryptå“ˆå¸Œ**:
```javascript
// åœ¨ Node.js ç¯å¢ƒä¸­
const bcrypt = require('bcryptjs');
const newPassword = 'your_new_password';
const hash = bcrypt.hashSync(newPassword, 10);
console.log(hash); // å¤åˆ¶è¿™ä¸ªå“ˆå¸Œå€¼åˆ°æ•°æ®åº“
```

### Q4: å¦‚ä½•æ·»åŠ æ›´å¤šç®¡ç†å‘˜

**æ–¹å¼1ï¼šé€šè¿‡æ•°æ®åº“æ·»åŠ **

åœ¨ `admins` é›†åˆä¸­æ·»åŠ æ–°è®°å½•ï¼š
```json
{
  "username": "manager1",
  "password": "<bcryptå“ˆå¸Œ>",
  "role": "operator",
  "permissions": ["order_manage", "product_manage"],
  "status": "active",
  "createTime": {"$date": "2026-02-24T00:00:00.000Z"}
}
```

**æ–¹å¼2ï¼šé€šè¿‡äº‘å‡½æ•°æ·»åŠ **ï¼ˆéœ€è¦å¼€å‘ï¼‰

åˆ›å»º `addAdmin` æ¥å£åœ¨ admin-api ä¸­ã€‚

---

## ğŸ“± ç™»å½•é¡µé¢é¢„è§ˆ

### UIè®¾è®¡

ç™»å½•é¡µé¢é‡‡ç”¨**ä¸œæ–¹ç¾å­¦**è®¾è®¡é£æ ¼ï¼š

- **èƒŒæ™¯**: æ·±è‰²æ¸å˜ (#1A1A1A â†’ #0D0D0D)
- **ä¸»è‰²**: ç¥ç€é‡‘ (#C9A962)
- **Logo**: åœ†å½¢ç™½è‰²Logoå¸¦é˜´å½±
- **è¾“å…¥æ¡†**: åŠé€æ˜ç™½è‰²èƒŒæ™¯ï¼Œèšç„¦æ—¶æ˜¾ç¤ºé‡‘è‰²è¾¹æ¡†
- **æŒ‰é’®**: æ¸å˜é‡‘è‰²æŒ‰é’®ï¼Œå¸¦é˜´å½±æ•ˆæœ
- **å­—ä½“**: ç”¨æˆ·åå’Œå¯†ç æ ‡é¢˜ä¼˜é›…æ˜¾ç¤º

### äº¤äº’ç»†èŠ‚

- âœ… å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢ï¼ˆçœ¼ç›å›¾æ ‡ï¼‰
- âœ… è¡¨å•éªŒè¯ï¼ˆç©ºå€¼æ£€æŸ¥ï¼‰
- âœ… åŠ è½½çŠ¶æ€ï¼ˆç™»å½•ä¸­æç¤ºï¼‰
- âœ… é”™è¯¯æç¤ºï¼ˆToastæ¶ˆæ¯ï¼‰
- âœ… è¿”å›ç”¨æˆ·ç«¯å…¥å£

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

ç™»å½•æˆåŠŸåï¼Œå»ºè®®ï¼š

1. **ä¿®æ”¹é»˜è®¤å¯†ç ** âš ï¸ é‡è¦
2. **æ·»åŠ å…¶ä»–ç®¡ç†å‘˜**ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. **é…ç½®ç®¡ç†æƒé™**ï¼ˆä¸åŒè§’è‰²ä¸åŒæƒé™ï¼‰
4. **ç†Ÿæ‚‰ç®¡ç†åŠŸèƒ½**ï¼ˆæµè§ˆå„ä¸ªé¡µé¢ï¼‰
5. **æµ‹è¯•å…³é”®æ“ä½œ**ï¼ˆè®¢å•å¤„ç†ã€å•†å“ç®¡ç†ç­‰ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ç®¡ç†åå°æ¶æ„**: `docs/ADMIN_ARCHITECTURE_EXPLANATION.md`
- **éƒ¨ç½²æŠ¥å‘Š**: `docs/ADMIN_DEPLOYMENT_REPORT.md`
- **å®‰å…¨ä¿®å¤**: `docs/ADMIN_SECURITY_FIXES_SUMMARY.md`
- **JWTé…ç½®**: `docs/ADMIN_JWT_CONFIG_SUMMARY.md`

---

**ç™»å½•è´¦å·**:
```
ç”¨æˆ·å: admin
å¯†ç : admin123
```

**ç™»å½•åœ°å€**:
- å°ç¨‹åºç«¯: `/pagesAdmin/login/index`
- H5 Webç«¯: `https://<static-hosting-domain>/admin/`

**é‡è¦æç¤º**:
âš ï¸ é»˜è®¤å¯†ç ä»…ç”¨äºæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼
