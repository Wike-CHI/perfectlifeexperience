# Admin Dashboard System - Testing Guide

## 部署步骤

### 1. 初始化管理员数据

1. 登录腾讯云 CloudBase 控制台
2. 导航到：云开发 → 云函数 → initAdminData
3. 点击"部署"按钮上传函数
4. 点击"运行"执行初始化
5. 记录返回的默认管理员凭证：
   - 用户名: `admin`
   - 密码: `admin123`

⚠️ **重要**: 首次登录后请立即修改密码！

### 2. 部署 admin-api 云函数

1. 导航到：云开发 → 云函数 → admin-api
2. 点击"部署"上传最新代码
3. 确认部署成功

### 3. 启动开发服务器

```bash
cd admin_dash
npm run dev:h5
```

4. 在浏览器中访问：`http://localhost:9000`

## 测试清单

### Phase 1: 管理员认证 ✅

**测试步骤**:
1. 访问 `http://localhost:9000/pages/admin/login/index`
2. 输入错误的用户名/密码
   - 预期：显示错误提示
3. 输入正确凭证：`admin` / `admin123`
4. 点击"登录"按钮

**预期结果**:
- ✅ 登录成功显示提示
- ✅ 自动跳转到 Dashboard
- ✅ adminInfo 保存在 localStorage
- ✅ `isAdminLoggedIn` 设置为 true

**数据库验证**:
- 在 CloudBase 控制台检查 `operation_logs` 集合
- 应该有一条 login 记录

### Phase 2: Dashboard 数据验证 ✅

**测试步骤**:
1. 登录后应该自动显示 Dashboard
2. 检查四个统计卡片

**预期结果**:
- ✅ 今日销售额：显示真实数据
- ✅ 本月销售额：显示真实数据
- ✅ 总用户数：显示实际数量
- ✅ 待处理任务：显示待发货订单数

**数据验证**:
- 今日销售额应该与今日订单总和一致
- 待处理任务应该链接到订单列表

### Phase 3: 商品管理 ✅

**测试步骤**:

#### 3.1 商品列表
1. 点击侧边栏"Products"菜单
2. 测试分类筛选
3. 测试状态筛选（在售/缺货）
4. 测试搜索功能
5. 测试分页

**预期结果**:
- ✅ 商品列表正确显示
- ✅ 分类筛选生效
- ✅ 状态筛选生效
- ✅ 搜索功能正常
- ✅ 分页切换正常

#### 3.2 创建商品
1. 点击"新增商品"按钮
2. 填写表单：
   - 商品名称: `测试啤酒`
   - 描述: `这是一个测试商品`
   - 价格: `29900` (分)
   - 库存: `100`
   - 分类: 选择一个分类
3. 点击"保存"按钮

**预期结果**:
- ✅ 表单验证正常
- ✅ 保存成功提示
- ✅ 返回列表页
- ✅ 新商品出现在列表中
- ✅ `operation_logs` 中有 createProduct 记录

#### 3.3 编辑商品
1. 点击任意商品的"编辑"按钮
2. 修改商品名称
3. 点击"保存"

**预期结果**:
- ✅ 表单预填充正确数据
- ✅ 修改保存成功
- ✅ 列表显示更新后的数据

#### 3.4 删除商品
1. 点击测试商品的"删除"按钮
2. 确认删除

**预期结果**:
- ✅ 删除确认对话框显示
- ✅ 删除成功提示
- ✅ 商品从列表移除

### Phase 4: 订单管理 ✅

**测试步骤**:

#### 4.1 订单列表
1. 点击侧边栏"Orders"菜单
2. 测试状态筛选
3. 测试订单号搜索
4. 测试分页

**预期结果**:
- ✅ 订单列表显示正确
- ✅ 状态颜色标识正确
- ✅ 筛选和搜索功能正常

#### 4.2 订单详情
1. 点击任意订单的"详情"按钮
2. 查看完整订单信息
3. 检查用户信息显示
4. 检查商品列表和金额

**预期结果**:
- ✅ 订单详情完整显示
- ✅ 用户信息正确
- ✅ 商品列表和金额计算正确

#### 4.3 状态更新
1. 找一个"已付款"状态的订单
2. 点击"标记发货"按钮
3. 验证状态变为"发货中"
4. 再点击"标记完成"按钮
5. 验证状态变为"已完成"

**预期结果**:
- ✅ 状态按钮根据当前状态显示
- ✅ 状态更新成功
- ✅ 时间戳自动记录
- ✅ `operation_logs` 中有 updateOrderStatus 记录

### Phase 5: 公告管理 ✅

**测试步骤**:

#### 5.1 公告列表
1. 手动访问 `http://localhost:9000/pages/announcements/list/index`
2. 测试类型筛选
3. 测试状态筛选

**预期结果**:
- ✅ 公告列表显示
- ✅ 类型标签颜色正确
- ✅ 状态显示正确

#### 5.2 创建公告
1. 点击"发布公告"按钮
2. 填写表单：
   - 标题: `测试公告`
   - 类型: `系统公告`
   - 优先级: `3`
   - 内容: `这是一条测试公告`
   - 立即发布: 开启
3. 点击"发布"按钮

**预期结果**:
- ✅ 创建成功提示
- ✅ 公告出现在列表中
- ✅ `operation_logs` 中有 createAnnouncement 记录

#### 5.3 编辑和删除公告
1. 点击公告进入编辑
2. 修改内容并保存
3. 返回列表删除公告

**预期结果**:
- ✅ 编辑功能正常
- ✅ 删除功能正常

### Phase 6: 推广管理 ✅

**测试步骤**:
1. 点击侧边栏"Promotion"菜单
2. 查看推广统计卡片
3. 查看最近推广订单

**预期结果**:
- ✅ 推广员总数显示
- ✅ 团队总数显示
- ✅ 奖励发放次数显示
- ✅ 最近订单列表显示

## 数据库验证清单

在 CloudBase 控制台验证以下集合：

### admins 集合
- ✅ 默认管理员账号已创建
- ✅ lastLoginTime 字段在登录后更新

### operation_logs 集合
- ✅ 所有管理员操作都有日志记录
- ✅ 包含 adminId, action, details, timestamp, ipAddress

### products 集合
- ✅ 新创建的商品存在
- ✅ 编辑后的商品字段更新正确
- ✅ 删除的商品已移除

### orders 集合
- ✅ 订单状态更新正确
- ✅ 时间戳字段正确记录

### announcements 集合
- ✅ 公告创建成功
- ✅ isActive 字段正确设置
- ✅ publishTime 在发布时自动设置

## 性能检查清单

- ✅ 页面加载时间 < 2秒
- ✅ API 响应时间 < 1秒
- ✅ 列表滚动流畅
- ✅ 表单提交响应迅速
- ✅ 无控制台错误

## 安全检查清单

- ✅ 未登录不能访问管理页面（待实现）
- ✅ 密码不以明文存储（待实现）
- ✅ 所有操作都有日志记录
- ✅ API 错误处理正确

## 已知问题和后续改进

1. **密码安全**: 当前使用明文存储，需要实现 bcrypt
2. **RBAC 权限**: 当前所有管理员权限相同，需要实现角色分离
3. **图片上传**: 产品图片上传功能需要测试 CloudBase Storage
4. **日期选择**: 某些页面的日期筛选功能待完善

## 测试完成标准

所有功能测试通过后：
- ✅ 所有 8 个任务已完成
- ✅ 8 个 git commits 已提交
- ✅ 核心功能可正常使用
- ✅ 数据库集成正常
- ✅ 无致命 bug

## 部署到生产环境

### 小程序端部署
```bash
cd admin_dash
npm run build:h5
```

将 `unpackage/dist/build/h5/` 目录部署到：
- CloudBase 静态网站托管
- 或其他 Web 服务器

### 环境变量配置
确保 `VITE_ENV_ID` 配置正确：
```bash
# .env.local
VITE_ENV_ID=cloud1-6gmp2q0y3171c353
```

---

**测试完成后，请提交测试结果报告。**
